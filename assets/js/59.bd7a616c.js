(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{337:function(s,t,n){s.exports=n.p+"assets/img/image-20210311102432156.1dc18aa2.png"},595:function(s,t,n){s.exports=n.p+"assets/img/a662d410dfdaa8ab44b36cbb68ab8d1b.a662d410.png"},760:function(s,t,n){"use strict";n.r(t);var a=n(13),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_07-我应该迁移到-https-吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_07-我应该迁移到-https-吗"}},[s._v("#")]),s._v(" 07 | 我应该迁移到 HTTPS 吗？")]),s._v(" "),a("p",[s._v("今天是安全篇的最后一讲，我们已经学完了 HTTPS、TLS 相关的大部分知识。不过，或许你心里还会有一些困惑：")]),s._v(" "),a("p",[s._v("HTTPS 这么复杂，我是否应该迁移到 HTTPS 呢？它能带来哪些好处呢？具体又应该怎么实施迁移呢？")]),s._v(" "),a("p",[s._v("这些问题不单是你，也是其他很多人，还有当初的我的真实想法，所以今天我就来跟你聊聊这方面的事情。")]),s._v(" "),a("h2",{attrs:{id:"迁移的必要性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迁移的必要性"}},[s._v("#")]),s._v(" 迁移的必要性")]),s._v(" "),a("p",[s._v("如果你做移动应用开发的话，那么就一定知道，Apple、Android、某信等开发平台在 2017 年就相继发出通知，要求所有的应用必须使用 HTTPS 连接，禁止不安全的 HTTP。")]),s._v(" "),a("p",[s._v("在台式机上，主流的浏览器 Chrome、Firefox 等也早就开始强推 HTTPS，把 HTTP 站点打上不安全的标签，给用户以心理压力。")]),s._v(" "),a("p",[s._v("Google 等搜索巨头还利用自身的话语权优势，降低 HTTP 站点的排名，而给 HTTPS 更大的权重，力图让网民只访问到 HTTPS 网站。")]),s._v(" "),a("p",[s._v("这些手段都逐渐挤压了纯明文 HTTP 的生存空间，迁移到 HTTPS已经不是要不要做的问题，而是要怎么做的问题了。HTTPS 的大潮无法阻挡，如果还是死守着 HTTP，那么无疑会被冲刷到互联网的角落里。")]),s._v(" "),a("p",[s._v("目前国内外的许多知名大站都已经实现了 "),a("strong",[s._v("全站 HTTPS")]),s._v(" ，打开常用的某宝、某东、某浪，")]),s._v(" "),a("p",[s._v("都可以在浏览器的地址栏里看到「小锁头」，如果你正在维护的网站还没有实施 HTTPS，那可要抓点紧了。")]),s._v(" "),a("h2",{attrs:{id:"迁移的顾虑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迁移的顾虑"}},[s._v("#")]),s._v(" 迁移的顾虑")]),s._v(" "),a("p",[s._v("据我观察，阻碍 HTTPS 实施的因素还有一些这样、那样的顾虑，我总结出了三个比较流行的观点：慢、贵、难")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("慢")]),s._v(" "),a("p",[s._v("是指惯性思维，拿以前的数据来评估 HTTPS 的性能，认为 HTTPS 会增加服务器的成本，增加客户端的时延，影响用户体验。")]),s._v(" "),a("p",[s._v("其实现在服务器和客户端的运算能力都已经有了很大的提升，性能方面完全没有担心的必要，而且还可以应用很多的优化解决方案。根据 Google 等公司的评估，在经过适当优化之后，HTTPS 的额外 CPU 成本小于 1%，额外的网络成本小于 2%，可以说是与无加密的 HTTP 相差无几")])]),s._v(" "),a("li",[a("p",[s._v("贵")]),s._v(" "),a("p",[s._v("主要是指证书申请和维护的成本太高，网站难以承担。")]),s._v(" "),a("p",[s._v("这也属于惯性思维，在早几年的确是个问题，向 CA 申请证书的过程不仅麻烦，而且价格昂贵，每年要交几千甚至几万元。")]),s._v(" "),a("p",[s._v("但现在就不一样了，为了推广 HTTPS，很多云服务厂商都提供了一键申请、价格低廉的证书，而且还出现了专门颁发免费证书的 CA，其中最著名的就是 "),a("strong",[s._v("Let’s Encrypt")]),s._v(" 。")])]),s._v(" "),a("li",[a("p",[s._v("难")]),s._v(" "),a("p",[s._v("是指 HTTPS 涉及的知识点太多、太复杂，有一定的技术门槛，不能很快上手。")]),s._v(" "),a("p",[s._v("这第三个顾虑比较现实，HTTPS 背后关联到了密码学、TLS、PKI 等许多领域，不是短短几周、几个月就能够精通的。但实施 HTTPS 也并不需要把这些完全掌握，只要抓住少数几个要点就好，下面我就来帮你逐个解决一些关键的难点 。")])])]),s._v(" "),a("h2",{attrs:{id:"申请证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#申请证书"}},[s._v("#")]),s._v(" 申请证书")]),s._v(" "),a("p",[s._v("要把网站从 HTTP 切换到 HTTPS，首先要做的就是为网站申请一张证书。")]),s._v(" "),a("p",[s._v("大型网站出于信誉、公司形象的考虑，通常会选择向传统的 CA 申请证书，例如 DigiCert、GlobalSign，而中小型网站完全可以选择使用 "),a("code",[s._v("Let’s Encrypt")]),s._v(" 这样的免费证书，效果也完全不输于那些收费的证书。")]),s._v(" "),a("p",[a("strong",[s._v("Let’s Encrypt")]),s._v(" 一直在推动证书的自动化部署，为此还实现了专门的 ACME 协议（RFC8555）。有很多的客户端软件可以完成申请、验证、下载、更新的一条龙操作，比如 Certbot、acme.sh 等等，都可以在 Let’s Encrypt 网站上找到，用法很简单，相关的文档也很详细，几分钟就能完成申请，所以我在这里就不细说了。")]),s._v(" "),a("p",[s._v("不过我必须提醒你几个注意事项。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("第一，申请证书时应当同时申请 RSA 和 ECDSA 两种证书，在 Nginx 里配置成 "),a("strong",[s._v("双证书验证")]),s._v(" ，这样服务器可以自动选择快速的椭圆曲线证书，同时也兼容只支持 RSA 的客户端。")])]),s._v(" "),a("li",[a("p",[s._v("第二，如果申请 RSA 证书，私钥至少要 2048 位，摘要算法应该选用 SHA-2，例如 SHA256、SHA384 等。")])]),s._v(" "),a("li",[a("p",[s._v("第三，出于安全的考虑，Let’s Encrypt 证书的有效期很短，只有 90 天，时间一到就会过期失效，所以必须要定期更新。你可以在 crontab 里加个每周或每月任务，发送更新请求，不过很多 ACME 客户端会自动添加这样的定期任务，完全不用你操心")])])]),s._v(" "),a("h2",{attrs:{id:"配置-https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-https"}},[s._v("#")]),s._v(" 配置 HTTPS")]),s._v(" "),a("p",[s._v("搞定了证书，接下来就是配置 Web 服务器，在 443 端口上开启 HTTPS 服务了。")]),s._v(" "),a("p",[s._v("这在 Nginx 上非常简单，只要在 "),a("code",[s._v("listen")]),s._v(" 指令后面加上参数 "),a("code",[s._v("ssl")]),s._v(" ，再配上刚才的证书文件就可以实现最基本的 HTTPS")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("listen                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \nssl_certificate       xxx_rsa.crt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsa2048 cert")]),s._v("\nssl_certificate_key   xxx_rsa.key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsa2048 private key")]),s._v("\n \nssl_certificate       xxx_ecc.crt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ecdsa cert")]),s._v("\nssl_certificate_key   xxx_ecc.key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ecdsa private ke")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("为了提高 HTTPS 的安全系数和性能，你还可以强制 Nginx 只支持 TLS1.2 以上的协议，打开 "),a("code",[s._v("Session Ticket")]),s._v(" 会话复用：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ssl_protocols               TLSv1.2 TLSv1.3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \nssl_session_timeout         5m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nssl_session_tickets         on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nssl_session_ticket_key      ticket.key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("密码套件的选择方面，我给你的建议是以服务器的套件优先。这样可以避免恶意客户端故意选择较弱的套件、降低安全等级，然后密码套件向 TLS1.3 看齐，只使用 ECDHE、AES 和 ChaCha20，支持 "),a("code",[s._v("False Start")]),s._v(" 。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ssl_prefer_server_ciphers   on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \nssl_ciphers   ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-CHACHA20-POLY1305:ECDHE+AES128:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("MD5:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("SHA1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如果你的服务器上使用了 OpenSSL 的分支 BorringSSL，那么还可以使用一个特殊的 等价密码组（Equal preference cipher groups）特性，它可以让服务器配置一组等价的密码套件，在这些套件里允许客户端优先选择，比如这么配置：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ssl_ciphers \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ECDHE-ECDSA-AES128-GCM-SHA256"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ECDHE-ECDSA-CHACHA20-POLY1305"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如果客户端硬件没有 AES 优化，服务器就会顺着客户端的意思，优先选择与 AES 等价的 ChaCha20 算法，让客户端能够快一点。")]),s._v(" "),a("p",[s._v("全部配置完成后，你可以访问 "),a("a",{attrs:{href:"https://www.ssllabs.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("SSLLabs"),a("OutboundLink")],1),s._v(" 网站，测试网站的安全程度，它会模拟多种客户端发起测试，打出一个综合的评分。")]),s._v(" "),a("p",[s._v("下图就是 GitHub 网站的评分结果：")]),s._v(" "),a("p",[a("img",{attrs:{src:n(595),alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"服务器名称指示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器名称指示"}},[s._v("#")]),s._v(" 服务器名称指示")]),s._v(" "),a("p",[s._v("配置 HTTPS 服务时还有一个“虚拟主机”的问题需要解决。")]),s._v(" "),a("p",[s._v("在 HTTP 协议里，多个域名可以同时在一个 IP 地址上运行，这就是 "),a("strong",[s._v("虚拟主机")]),s._v("，Web 服务器会使用请求头里的 Host 字段来选择。")]),s._v(" "),a("p",[s._v("但在 HTTPS 里，"),a("strong",[s._v("因为请求头只有在 TLS 握手之后才能发送")]),s._v(" ，"),a("strong",[s._v("在握手时就必须选择虚拟主机对应的证书")]),s._v(" ，TLS 无法得知域名的信息，就只能用 IP 地址来区分。所以，最早的时候每个 HTTPS 域名必须使用独立的 IP 地址，非常不方便。")]),s._v(" "),a("p",[s._v("那么怎么解决这个问题呢？")]),s._v(" "),a("p",[s._v("这还是得用到 TLS 的「扩展」，给协议加个 "),a("strong",[s._v("SNI")]),s._v("（Server Name Indication）的补充条款 。它的作用和 Host 字段差不多，客户端会在 "),a("code",[s._v("Client Hello")]),s._v(" 时带上域名信息，这样服务器就可以根据名字而不是 IP 地址来选择证书。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Extension: server_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("len"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    Server Name Indication extension\n        Server Name Type: host_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        Server Name: www.chrono.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("Nginx 很早就基于 SNI 特性支持了 HTTPS 的虚拟主机，但在 OpenResty 里可还以编写 Lua 脚本，利用 Redis、MySQL 等数据库更灵活快速地加载证书。")]),s._v(" "),a("h2",{attrs:{id:"重定向跳转"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重定向跳转"}},[s._v("#")]),s._v(" 重定向跳转")]),s._v(" "),a("p",[s._v("现在有了 HTTPS 服务，但原来的 HTTP 站点也不能马上弃用，还是会有很多网民习惯在地址栏里直接敲域名（或者是旧的书签、超链接），默认使用 HTTP 协议访问。")]),s._v(" "),a("p",[s._v("所以，之前讲解过的的 "),a("strong",[s._v("重定向跳转")]),s._v(" 技术了，把不安全的 HTTP 网址用 301 或 302 重定向到新的 HTTPS 网站，这在 Nginx 里也很容易做到，使用 return 或 rewrite 都可以。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久重定向")]),s._v("\nrewrite ^  https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),s._v(" permanent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久重定向")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("但这种方式有两个问题。一个是重定向增加了网络成本，多出了一次请求；另一个是存在安全隐患，重定向的响应可能会被中间人窜改，实现 "),a("strong",[s._v("会话劫持")]),s._v(" ，跳转到恶意网站。")]),s._v(" "),a("p",[s._v("不过有一种叫 "),a("strong",[s._v("HSTS")]),s._v("（HTTP 严格传输安全，HTTP Strict Transport Security）的技术可以消除这种安全隐患。HTTPS 服务器需要在发出的响应头里添加一个 "),a("strong",[s._v("Strict-Transport-Security")]),s._v(" 的字段，再设定一个有效期，例如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Strict-Transport-Security: max-age"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15768000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" includeSubDomains\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这相当于告诉浏览器：我这个网站必须严格使用 HTTPS 协议，在半年之内（182.5 天）都不允许用 HTTP，你以后就自己做转换吧，不要再来麻烦我了。")]),s._v(" "),a("p",[s._v("有了 HSTS 的指示，以后浏览器再访问同样的域名的时候就会自动把 URI 里的 "),a("code",[s._v("http")]),s._v(" 改成 "),a("code",[s._v("https")]),s._v(" ，直接访问安全的 HTTPS 网站。这样中间人就失去了攻击的机会，而且对于客户端来说也免去了一次跳转，加快了连接速度。")]),s._v(" "),a("p",[s._v("比如，如果在实验环境的配置文件里用 "),a("code",[s._v("add_header")]),s._v(" 指令添加 HSTS 字段：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("add_header Strict-Transport-Security max-age"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15768000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#182.5days")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("那么 Chrome 浏览器只会在第一次连接时使用 HTTP 协议，之后就会都走 HTTPS 协议。")]),s._v(" "),a("h2",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("p",[s._v("今天我介绍了一些 HTTPS 迁移的技术要点，掌握了它们你就可以搭建出一个完整的 HTTPS 站点了。")]),s._v(" "),a("p",[s._v("但想要实现大型网站的 「全站 HTTPS」还是需要有很多的细枝末节的工作要做，比如使用 CSP（Content Security Policy）的各种指令和标签来配置安全策略，使用反向代理来集中「卸载」SSL，话题太大，以后有机会再细谈吧。")]),s._v(" "),a("p",[s._v("简单小结一下今天的内容：")]),s._v(" "),a("ol",[a("li",[s._v("从 HTTP 迁移到 HTTPS 是大势所趋，能做就应该尽早做；")]),s._v(" "),a("li",[s._v("升级 HTTPS 首先要申请数字证书，可以选择免费好用的 Let’s Encrypt；")]),s._v(" "),a("li",[s._v("配置 HTTPS 时需要注意选择恰当的 TLS 版本和密码套件，强化安全；")]),s._v(" "),a("li",[s._v("原有的 HTTP 站点可以保留作为过渡，使用 301 重定向到 HTTPS。")])]),s._v(" "),a("h2",{attrs:{id:"课下作业"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#课下作业"}},[s._v("#")]),s._v(" 课下作业")]),s._v(" "),a("ol",[a("li",[s._v("结合你的实际工作，分析一下迁移 HTTPS 的难点有哪些，应该如何克服？")]),s._v(" "),a("li",[s._v("参考上一讲，你觉得配置 HTTPS 时还应该加上哪些部分？")])]),s._v(" "),a("h2",{attrs:{id:"拓展阅读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拓展阅读"}},[s._v("#")]),s._v(" 拓展阅读")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("也有少数知名网站仍然坚持使用 HTTP，例如 nginx. org、 apache.org")])]),s._v(" "),a("li",[a("p",[s._v("SN 使用明文表示域名，也就提前暴露了一部分 Https 的信息，有安全隐患，容易被中间人 "),a("strong",[s._v("发起拒绝攻击")]),s._v("，被认为是 TLS 盔甲上最后的一个缝隙，目前正在起草 ESN 规范")])]),s._v(" "),a("li",[a("p",[s._v("HSTS 无法防止黑客对第一次访问的攻击，所以 Chrome 等浏览器还内置了一个 HSTS preload 的列表("),a("code",[s._v("chrome://net-internals/#hsts")]),s._v(" )，只要域名在这个列表里，无论何时都会强制使用 Https 访问")])]),s._v(" "),a("li",[a("p",[s._v("HPKP ( Http Public Key Pinning) 是另一种 Https 安全技术，指示客户端固定网站使用的公钥，防止中间人攻击，但因为接受程度过低，现在已经被放弃")])]),s._v(" "),a("li",[a("p",[s._v("如果要支持老的 WindowsXP 和 IE6，可以选择开启 SSLv3 和 RSA、RC4、SHA")])]),s._v(" "),a("li",[a("p",[s._v("之前在实验环境访问 HTTP 协议时可以看到请求头里有 "),a("code",[s._v("Upgrade- nsecure- Requests:1")]),s._v("，它就是 CSP 的一种，表示浏览器支持升级到 Https 协议")])]),s._v(" "),a("li",[a("p",[s._v("文中提到的虚拟主机，跟正向代理，反向代理，有什么区别？")]),s._v(" "),a("p",[s._v("虚拟主机与代理没有关系，是 http 服务器里的概念，在一个 ip 地址上存在多个域名（即主机），所以叫「虚拟主机」")]),s._v(" "),a("p",[s._v("因为不能用 ip 地址区分，所以就要用 host 字段，区分不同的主机（域名、网站）。")])])]),s._v(" "),a("h2",{attrs:{id:"let-s-encrypt-证书-certbot-启动续期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#let-s-encrypt-证书-certbot-启动续期"}},[s._v("#")]),s._v(" Let’s Encrypt 证书 certbot 启动续期")]),s._v(" "),a("p",[s._v("笔者是在 CentOS7 上测试的，"),a("a",{attrs:{href:"https://certbot.eff.org/lets-encrypt/centosrhel7-nginx",target:"_blank",rel:"noopener noreferrer"}},[s._v("可以参考 certbot CentOS7 官方安装文档"),a("OutboundLink")],1),s._v("，他的安装文档步骤很详细，简单说有以下两步：")]),s._v(" "),a("ol",[a("li",[s._v("安装 snapd，文档中给出了 snapd 的官方安装文档，照着命令做即可")]),s._v(" "),a("li",[s._v("安装 certbot")])]),s._v(" "),a("p",[s._v("安装好 Certbot 后，可以使用 Certbot，步骤如下：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("先配置 nginx.conf 文件，主要配置是 server_name 也就是你的域名，不然 Certbot 找不到你的配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    server {\n        # 配置好域名\n        server_name  mrcode.cn;\n        root /usr/servers/notework/release/mrcode-book/;\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n        }\n\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("笔者这里比较简单，是一个静态网页")])]),s._v(" "),a("li",[a("p",[s._v("运行 certbot")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("certbot --nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这一步会有两种情况：")]),s._v(" "),a("ol",[a("li",[s._v("当你没有配置域名的时候，会提示你输入你的域名，然后继续后面的步骤")]),s._v(" "),a("li",[s._v("当你配置了域名，会自动进行后面的步骤")])]),s._v(" "),a("p",[s._v("当配置成功后，后打印出你的证书和私钥路径等信息，笔者这里没有保留下来")])]),s._v(" "),a("li",[a("p",[s._v("测试自动续期程序")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("certbot renew --dry-run\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Cert not due "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" renewal, but simulating renewal "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" dry run\nPlugins selected: Authenticator nginx, Installer nginx\nSimulating renewal of an existing certificate "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" mrcode.cn\nPerforming the following challenges:\nhttp-01 challenge "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" mrcode.cn\nWaiting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" verification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nCleaning up challenges\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nnew certificate deployed with reload of nginx server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" fullchain is\n/etc/letsencrypt/live/mrcode.cn/fullchain.pem\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nCongratulations, all simulated renewals succeeded: \n  /etc/letsencrypt/live/mrcode.cn/fullchain.pem "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("success"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("上述自己翻译下，大概意思是，证书还未到期，提供模拟信息给你预览。说明后续自动续期的时候应该没有什么问题")])]),s._v(" "),a("li",[a("p",[s._v("自动续期任务确定")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# certbot 安装 https 后，会将定时任务写入以下目录之一")]),s._v("\n/etc/crontab/\n/etc/cron.*/*\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以使用如下命令查看任务列表")]),s._v("\nsystemctl list-timers\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl list-timers")]),s._v("\nNEXT                         LEFT          LAST                         PASSED  UNIT                         ACTIVATES\nThu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-03-11 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":48:00 CST  1h 28min left n/a                          n/a     snap.certbot.renew.timer     snap.certbot.renew.service\nThu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-03-11 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":06:09 CST  12h left      Wed "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-03-10 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":06:09 CST  11h ago systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一个任务就是续期的任务，证明也没有问题")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])]),s._v(" "),a("p",[s._v("笔者这里生成的配置文件如下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For more information on configuration, see:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   * Official English Documentation: http://nginx.org/en/docs/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   * Official Russian Documentation: http://nginx.org/ru/docs/")]),s._v("\n\nuser nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nworker_processes auto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nerror_log /var/log/nginx/error.log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\npid /run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load dynamic modules. See /usr/share/nginx/README.dynamic.")]),s._v("\ninclude /usr/share/nginx/modules/*.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log_format  main  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$time_local")]),s._v('] "'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request")]),s._v("\" '")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$body_bytes_sent")]),s._v(' "'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_referer")]),s._v("\" '")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\""),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v('" "'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_x_forwarded_for")]),s._v("\"'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    access_log  /var/log/nginx/access.log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    sendfile            on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tcp_nopush          on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tcp_nodelay         on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    keepalive_timeout   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    types_hash_max_size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    include             /etc/nginx/mime.types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type        application/octet-stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load modular configuration files from the /etc/nginx/conf.d directory.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See http://nginx.org/en/docs/ngx_core_module.html#include")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for more information.")]),s._v("\n    include /etc/nginx/conf.d/*.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        server_name  mrcode.cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        root /usr/servers/notework/release/mrcode-book/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load configuration files for the default server block.")]),s._v("\n        include /etc/nginx/default.d/*.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        error_page "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" /404.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /40x.html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        error_page "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" /50x.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /50x.html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最主要的是增加了下面的配置")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":443 ssl "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ipv6only")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n    ssl_certificate /etc/letsencrypt/live/mrcode.cn/fullchain.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n    ssl_certificate_key /etc/letsencrypt/live/mrcode.cn/privkey.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意这里的配置文件，上面文章中说到的一些配置参数，在这个文件中基本都有配置了")]),s._v("\n    include /etc/letsencrypt/options-ssl-nginx.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 还有这里的配置，将 http 转发到  https")]),s._v("\n    server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mrcode.cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n\n\n        listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" default_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        listen       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":80 default_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  mrcode.cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br")])]),a("p",[s._v("最后一个是关于效果的确认")]),s._v(" "),a("p",[a("img",{attrs:{src:n(337),alt:"image-20210311102432156"}})]),s._v(" "),a("p",[s._v("该信息是点击小锁头里面有一个证书信息选项，打开后，就是该界面，另外前面说到的证书链如上图所示，mrcode.cn 的证书是 R3 也就是 Let’s Encrypt 签名的，而 Let’s Encrypt 的证书是 ROOT CAT X3 签名的")])])}),[],!1,null,null,null);t.default=e.exports}}]);